<!DOCTYPE html>
<html>
<head>
    <title>Thin Film Interference with D3.js</title>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/d3/3.4.13/d3.min.js" charset="utf-8"></script>
<style type="text/css">
			
			.axis path,
			.axis line {
				fill: none;
				stroke: black;
				shape-rendering: crispEdges;
			}
			
			.axis text {
				font-family: sans-serif;
				font-size: 11px;
			}

		</style>
	</head>
	<body>
	<script type="text/javascript">
		//Width and height
		var w = 1000;
		var h = 800;
		var padding = 30;
			
		//Dynamic, random dataset
		var dataset = [];					//Initialize empty array
		var numDataPoints = 200;				//Number of dummy data points to create
		var xMin = 350;
		var xMax = 800;
		var xRange = xMax - xMin;	//Max range of new x values
		var yRange = 100;	//Max range of new y values
		for (var i = 0; i < numDataPoints; i++) {					//Loop numDataPoints times
			var newNumber1 = xMin + i*(xRange/(numDataPoints-1));	//New random integer
			var newNumber2 = bragg(newNumber1, [100, 100], [1.5, 1.33], 1.54);	//New random integer
			dataset.push([newNumber1, newNumber2]);					//Add new number to array
		}

		//Create scale functions
		var xScale = d3.scale.linear()
			.domain([xMin, xMax])
			.range([padding, w - padding * 2]);
		var yScale = d3.scale.linear()
			.domain([0, 100])
			.range([h - padding, padding]);
		//Define X axis
		var xAxis = d3.svg.axis()
			.scale(xScale)
			.orient("bottom")
			.ticks(5);
		//Define Y axis
		var yAxis = d3.svg.axis()
			.scale(yScale)
			.orient("left")
			.ticks(5);

		//Create SVG element
		var svg = d3.select("body")
			.append("svg")
			.attr("width", w)
			.attr("height", h);
			
		var xCur = dataset[0][0];
		var yCur = dataset[0][1]
		var curvePath = "M" + xScale(xCur) + "," + yScale(yCur);
		for (i = 1; i < numDataPoints; i++) {					//Loop numDataPoints times
			xCur = xScale(dataset[i][0]);
			yCur = yScale(dataset[i][1]);
			curvePath = curvePath + "L" + xCur + "," + yCur; 
		}
		
		svg.append("g").append("path")
			.attr("d", curvePath)
			.attr("stroke","red")
			.attr("stroke-width",3)
			.attr("fill","none");
		
		var tooltip = svg.append("g").append("text");
		//Create circles
		svg.selectAll("circle")
		   .data(dataset)
		   .enter()
		   .append("circle")
		   .attr("cx", function(d) {
		   		return xScale(d[0]);
		   })
		   .attr("cy", function(d) {
		   		return yScale(d[1]);
		   })
		   .attr("r", 4)
		   .attr("pointer-events","visible")
		   .attr("fill","none")
		   .attr("data", function(d) { return d; })
		   .on("mouseover", updateTooltip)
		   .on("mouseout", hideTooltip);
		
		
		
		//Create X axis
		svg.append("g")
			.attr("class", "axis")
			.attr("transform", "translate(0," + (h - padding) + ")")
			.call(xAxis);
		
		//Create Y axis
		svg.append("g")
			.attr("class", "axis")
			.attr("transform", "translate(" + padding + ",0)")
			.call(yAxis);
		
		function updateTooltip()
		{
			var d = d3.select(this).attr("data").split(",");
			tooltip.text(Math.round(d[0]) + "," + Math.round(d[1]))
			   .attr("x", Number(d3.select(this).attr("cx"))+5)
			   .attr("y", Number(d3.select(this).attr("cy"))-5)
			   .attr("fill","red");
			d3.select(this).attr("fill","black");
		}
		function hideTooltip()
		{
			tooltip.attr("fill","none");
			d3.select(this).attr("fill","none");
		}
		function bragg(wl, tt, nn, nsub)
		{
			var M = [[1, 0], [0, 1]];
			var nprev = 1;
			var ncur = 1;
			var kx = 1;
			for (var i=0; i<tt.length; i++)
			{
				nprev = ncur;
				ncur = nn[i];
				kx = 2*Math.pi*(ncur) / wl;
				var T = trans(nprev,ncur),
					P = prop(kx,tt[i]);
				console.log(T[0][0],T[0][1],T[1][0],T[1][1]);
				M = matMult(M,trans(nprev,ncur));
				M = matMult(M,prop(kx,tt[i]));
			}
			M = matMult(M,trans(ncur,nsub));
			var r = Math.abs(M[2][1]/M[1][1]) ^ 2;
		}
		function prop(kx, t)
		{
			var i = Math.complex(0,1);
			var M = [[Math.exp(i*kx*t), 0], [0, Math.exp(-i*kx*t)]];
			return M;
		}
		function trans(ni, nj)
		{
			var 	r = (ni - nj)/(ni+nj),
				t = 1 + r;
			var M = [[1, r], [r, 1]] / t;
		}
		function matMult(A,B)
		{
			var M = [[A[0][0]*B[0][0]+A[0][1]*B[1][0], A[0][0]*B[0][1]+A[0][1]*B[1][1]], [A[1][0]*B[0][0]+A[1][1]*B[1][0], A[1][0]*B[0][1]+A[1][1]*B[1][1]]];
			return M;
		}
	</script>
</body>
</html>
